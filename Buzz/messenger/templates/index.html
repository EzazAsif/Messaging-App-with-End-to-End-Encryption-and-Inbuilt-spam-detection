{% load static %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">

<h1 class="bold">Welcome {{ request.user.first_name }} {{ request.user.last_name }}</h1>

Message: <p style="font-weight: bold; font-size: 16px;" id="message">{{ message }}</p>
<br>

{% if pred %}
    Spam? : <p style="color: red; font-weight: bold;">{{ pred }}</p>
{% else %}
    Spam? : <p style="color: green; font-weight: bold;">{{ pred }}</p>
{% endif %}

<p style="font-weight: bold; font-size: 16px;">Encrypted message using Python:<br>{{ encrypted_message }}</p> 
<p style="font-weight: bold; font-size: 16px;">Decrypted message using Python:<br>{{ decrypted_message }}</p> 

<p style="font-weight: bold; font-size: 16px;" id="enc">Encrypted message using JS: <span id="jsEncryptedMessage"></span></p> 
<p style="font-weight: bold; font-size: 16px;" id="dec">Decrypted message using JS: <span id="jsDecryptedMessage"></span></p> 

<form method="POST" action="{% url "index" %}">
    {% csrf_token %}
    <input name="message" type="text" required>
    <button type="submit" class="btn btn-success">Submit</button>
</form>

<a href="{% url 'logout' %}"><button type="button" class="btn btn-danger">Logout</button></a>



<script src="{% static 'encryptor.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>

    
    // Fetch the message to be encrypted
    const message = document.getElementById("message").innerText;

    // Async function to handle encryption and decryption
    async function processEncryption() {
        
            // Encrypt the message
            const encryptedMessage = await encryptMessage(message);
            document.getElementById("jsEncryptedMessage").innerText = encryptedMessage;

            // Decrypt the message
            const decryptedMessage = await decryptMessage(encryptedMessage);
            document.getElementById("jsDecryptedMessage").innerText = decryptedMessage;
        
    }

    // Run the encryption process after the page loads
    window.onload = processEncryption;
</script>
